# This is a basic workflow to help you get started with Actions

name: CI

on:
  schedule:
    - cron:  '0 * * * *'

jobs:
  clone-source:
    runs-on: ubuntu-latest
    steps:
    - name: Clone source
      uses: actions/checkout@v2
      with:
          repository: 'CSSEGISandData/COVID-19'
    - name: Copy files
      run: |
        mkdir csv
        mv csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv csv/confirmed.csv
        mv csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Deaths.csv csv/deaths.csv
        mv csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Recovered.csv csv/recovered.csv
    - name: Upload files
      uses: actions/upload-artifact@v1
      with:
        name: csv
        path: csv
  update-data:
    needs: clone-source
    runs-on: ubuntu-latest
    steps:
    - name: Clone our repo
      uses: actions/checkout@v2
      with:
          repository: 'enrichman/covid19'
    - name: Download files
      uses: actions/download-artifact@v1
      with:
        name: csv
        path: csv
    - name: Push on our repo
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git commit -m "Update data" -a
    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch: test-flow
  create-site:
    needs: update-data
    runs-on: ubuntu-latest
    steps:
    # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
    - uses: actions/checkout@v2
      with:
        path: main
    - uses: actions/checkout@v2
      with:
        path: site
        repository: 'enrichman/enrichman.github.io'
  
    # Runs a set of commands using the runners shell
    - name: Run a multi-line script
      run: |
        mkdir site/covid19
        mv main/world site/covid19/
        cd site
        git add covid19
        git commit -m "Update covid19"
    
    - uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
